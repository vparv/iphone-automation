<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liene Photo HD Automation Launcher</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            border-radius: 10px;
            padding: 15px 25px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .image-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .image-slot.completed {
            background: rgba(76, 175, 80, 0.8);
        }
        .image-slot.processing {
            background: rgba(255, 193, 7, 0.8);
            animation: pulse 1s infinite;
        }
        .image-slot.failed {
            background: rgba(244, 67, 54, 0.8);
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        .input-group {
            margin: 15px 0;
        }
        input, select {
            padding: 10px;
            border-radius: 8px;
            border: none;
            margin: 0 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            width: 0%;
            transition: width 0.3s ease;
        }
        /* Floating eyeball toggle */
        .eyeball-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 45%, #ffffff 0%, #e9f1ff 60%, #c8d8ff 100%);
            border: 2px solid rgba(0,0,0,0.15);
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
        }
        .eyeball-pupil {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 35% 35%, #2b2b2b 0%, #000 60%, #000 100%);
            border-radius: 50%;
            box-shadow: inset 0 0 0 6px #3aa0ff, 0 2px 6px rgba(0,0,0,0.4);
        }
        /* Full-screen overlay */
        .abg-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
            display: none;
            z-index: 1000; /* typically sits behind a motor UI if present */
        }
        .abg-overlay.active { display: block; }
        .abg-overlay-inner {
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
            border-radius: 16px;
            background: rgba(255,255,255,0.08);
            box-shadow: 0 10px 30px rgba(0,0,0,0.35);
            color: #fff;
        }
        .abg-title { margin: 0 0 12px; font-size: 20px; font-weight: 700; }
        .abg-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 12px;
        }
        .abg-card {
            position: relative;
            border-radius: 12px;
            padding: 14px 14px 56px 14px;
            background: rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.12);
        }
        .abg-card h4 { margin: 0 0 6px; font-size: 14px; opacity: 0.9; }
        .abg-meta { font-size: 12px; opacity: 0.8; margin-bottom: 6px; }
        .abg-address { font-size: 13px; line-height: 1.35; font-weight: 600; opacity: 0.95; }
        .abg-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            margin-left: 6px;
            background: rgba(46, 204, 113, 0.25);
            border: 1px solid rgba(46, 204, 113, 0.6);
        }
        .abg-badge.blocked { background: rgba(231, 76, 60, 0.25); border-color: rgba(231, 76, 60, 0.6); }
        .abg-thumb {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 64px;
            height: 64px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 6px 14px rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.25);
        }
        /* Grid item: person image prioritized in bottom corner */
        .image-slot { position: relative; overflow: hidden; }
        .person-thumb {
            position: absolute;
            bottom: 6px;
            right: 6px;
            width: 64px;
            height: 64px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 6px 14px rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.25);
            z-index: 1;
        }
        .slot-label { position: absolute; top: 6px; left: 8px; font-size: 11px; opacity: 0.8; }
        .no-scroll { overflow: hidden; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Liene Photo HD Automation</h1>
        
        <div class="grid">
            <div class="card">
                <h3>üì∏ Quick Actions</h3>
                <button onclick="startFromImage(1)">Start from Image 1</button>
                <button onclick="startFromImage(5)">Start from Image 5</button>
                <button onclick="startFromImage(9)">Start from Image 9</button>
                <button onclick="startFromImage(13)">Start from Image 13</button>
            </div>
            
            <div class="card">
                <h3>üéØ Custom Start</h3>
                <div class="input-group">
                    <label>Start from Image:</label>
                    <input type="number" id="startImage" min="1" max="16" value="1">
                    <label>Process:</label>
                    <input type="number" id="numImages" min="1" max="16" value="4">
                </div>
                <button onclick="startCustom()">Start Custom</button>
            </div>
            
            <div class="card">
                <h3>‚öôÔ∏è Controls</h3>
                <button onclick="processAll16()">Process All 16</button>
                <button onclick="testSingle()">Test Single Image</button>
                <button onclick="resetState()">Reset to Image 1</button>
                <button onclick="stopAutomation()" id="stopBtn" disabled>Stop</button>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="status" id="statusLog">
            üöÄ Ready to start automation...<br>
            üìç Click any button above to begin processing images.<br>
            üí° Tip: Start with "Test Single Image" to verify everything works.
        </div>

        <h3>üìä Image Processing Grid (1-16)</h3>
        <div class="image-grid" id="imageGrid">
            <!-- Grid will be populated by JavaScript -->
        </div>
    </div>

    <!-- Active Batch Gallery overlay -->
    <div id="galleryOverlay" class="abg-overlay" aria-hidden="true">
        <div class="abg-overlay-inner" role="dialog" aria-modal="true" aria-labelledby="abgTitle">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
                <h3 id="abgTitle" class="abg-title">Active Batch Gallery</h3>
                <button onclick="toggleOverlay(false)" style="background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.35);border-radius:8px;padding:6px 10px;color:#fff;cursor:pointer;">Close</button>
            </div>
            <div style="font-size:12px;opacity:0.85;margin-bottom:10px;">Background is dimmed with slight transparency. This view prioritizes the person's square image and the validated shipping address. Only order number and block status are shown; other details are hidden.</div>
            <div id="abgList" class="abg-list"></div>
        </div>
    </div>

    <!-- Floating eyeball toggle -->
    <div class="eyeball-btn" id="eyeballBtn" title="Toggle Active Batch Gallery" onclick="toggleOverlay()">
        <div class="eyeball-pupil"></div>
    </div>

    <script>
        let currentProcess = null;
        let processedImages = new Set();
        // Mock gallery data with emphasis on validated shipping address
        const galleryData = Array.from({ length: 16 }).map((_, idx) => ({
            id: idx + 1,
            orderNumber: `ORD-${String(idx + 1).padStart(4, '0')}`,
            shippingAddress: `Validated: ${100 + idx} Market St, Suite ${10 + idx}, Springfield, USA`,
            isBlocked: (idx % 7 === 0) // arbitrary sample blocks
        }));
        
        // Initialize image grid
        function initGrid() {
            const grid = document.getElementById('imageGrid');
            for (let i = 1; i <= 16; i++) {
                const slot = document.createElement('div');
                slot.className = 'image-slot';
                slot.id = `image-${i}`;
                const label = document.createElement('div');
                label.className = 'slot-label';
                label.textContent = `#${i}`;
                const img = document.createElement('img');
                img.className = 'person-thumb';
                img.alt = `Person ${i}`;
                img.src = 'images/1-home.png'; // placeholder; person image prioritized over any sticker sheet
                slot.appendChild(label);
                slot.appendChild(img);
                grid.appendChild(slot);
            }
        }
        
        // Update status log
        function log(message) {
            const statusLog = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString();
            statusLog.innerHTML += `<br>[${timestamp}] ${message}`;
            statusLog.scrollTop = statusLog.scrollHeight;
        }
        
        // Update progress bar
        function updateProgress(completed, total) {
            const progressFill = document.getElementById('progressFill');
            const percentage = (completed / total) * 100;
            progressFill.style.width = `${percentage}%`;
        }
        
        // Mark image status
        function setImageStatus(imageNum, status) {
            const slot = document.getElementById(`image-${imageNum}`);
            slot.className = `image-slot ${status}`;
            if (status === 'completed') {
                processedImages.add(imageNum);
            }
        }
        
        // Generate Python command
        function generatePythonCommand(startImage, numImages) {
            return `python3 -c "
from batch_processor import BatchProcessor
import time

processor = BatchProcessor()

# Process images ${startImage} to ${startImage + numImages - 1}
for i in range(${startImage}, ${startImage + numImages}):
    print(f'üéØ Processing Image #{i}')
    
    # Calculate position
    row = (i - 1) // 4
    col = (i - 1) % 4
    
    # Set position
    processor.navigator.save_state(row, col)
    
    # Navigate to gallery
    processor.navigator.navigate_to_gallery()
    time.sleep(1.5)
    
    # Select image
    processor.navigator.select_next_image()
    time.sleep(1.5)
    
    # Run workflow
    result = processor.run_core_workflow()
    if result:
        print(f'‚úÖ Image #{i} completed')
    else:
        print(f'‚ùå Image #{i} failed')
    
    time.sleep(2)

print('üéâ Batch completed!')
"`;
        }
        
        // Start automation functions
        function startFromImage(imageNum) {
            log(`üöÄ Starting automation from Image #${imageNum}`);
            log(`üìù Command: Process 4 images starting from #${imageNum}`);
            
            const command = generatePythonCommand(imageNum, 4);
            log(`üîß Generated Python command - copy and run in terminal:`);
            log(`<br><code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px;">${command}</code>`);
            
            // Simulate processing visualization
            for (let i = imageNum; i < imageNum + 4 && i <= 16; i++) {
                setTimeout(() => {
                    setImageStatus(i, 'processing');
                    setTimeout(() => {
                        setImageStatus(i, 'completed');
                        updateProgress(processedImages.size, 16);
                    }, 2000);
                }, (i - imageNum) * 1000);
            }
        }
        
        function startCustom() {
            const startImage = parseInt(document.getElementById('startImage').value);
            const numImages = parseInt(document.getElementById('numImages').value);
            
            log(`üéØ Custom automation: ${numImages} images starting from #${startImage}`);
            
            const command = generatePythonCommand(startImage, numImages);
            log(`üîß Generated Python command:`);
            log(`<br><code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px;">${command}</code>`);
        }
        
        function processAll16() {
            log(`üåü Starting full 16-image automation`);
            
            const command = `python3 robust_16_processor.py`;
            log(`üîß Command to run: <code>${command}</code>`);
            log(`üìñ This will process all images 1-16 with robust error handling`);
        }
        
        function testSingle() {
            log(`üß™ Testing single image automation`);
            
            const command = `python3 -c "
from batch_processor import BatchProcessor
processor = BatchProcessor()
processor.navigator.reset_state()
processor.navigator.navigate_to_gallery()
processor.navigator.select_next_image()
processor.run_core_workflow()
"`;
            log(`üîß Test command:`);
            log(`<br><code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px;">${command}</code>`);
        }
        
        function resetState() {
            log(`üîÑ Resetting to Image #1`);
            processedImages.clear();
            
            // Reset all image slots
            for (let i = 1; i <= 16; i++) {
                setImageStatus(i, '');
            }
            updateProgress(0, 16);
            
            const command = `python3 -c "
from gallery_navigator import GalleryNavigator
nav = GalleryNavigator()
nav.reset_state()
print('‚úÖ Reset to Image #1')
"`;
            log(`üîß Reset command:`);
            log(`<br><code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px;">${command}</code>`);
        }
        
        function stopAutomation() {
            log(`‚èπÔ∏è Stop automation (press Ctrl+C in terminal)`);
        }

        // Build overlay cards focusing on shipping address, order number, and block status
        function buildOverlay() {
            const list = document.getElementById('abgList');
            list.innerHTML = '';
            galleryData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'abg-card';
                const title = document.createElement('h4');
                title.textContent = `Order ${item.orderNumber}`;
                const badge = document.createElement('span');
                badge.className = 'abg-badge' + (item.isBlocked ? ' blocked' : '');
                badge.textContent = item.isBlocked ? 'Blocked' : 'OK';
                title.appendChild(badge);

                const address = document.createElement('div');
                address.className = 'abg-address';
                address.textContent = item.shippingAddress; // Validated shipping address emphasized

                const thumb = document.createElement('img');
                thumb.className = 'abg-thumb';
                thumb.src = 'images/1-home.png'; // placeholder person square image
                thumb.alt = `Person ${item.id}`;

                card.appendChild(title);
                card.appendChild(address);
                card.appendChild(thumb);
                list.appendChild(card);
            });
        }

        // Toggle overlay visibility
        function toggleOverlay(force) {
            const overlay = document.getElementById('galleryOverlay');
            const shouldOpen = force !== undefined ? force : !overlay.classList.contains('active');
            if (shouldOpen) {
                buildOverlay();
                overlay.classList.add('active');
                document.body.classList.add('no-scroll');
            } else {
                overlay.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        }
        
        // Initialize on load
        window.onload = function() {
            initGrid();
            log(`üéâ Automation Launcher Ready!`);
            log(`üí° Choose an option above to generate the appropriate Python command.`);
        };
    </script>
</body>
</html>
